<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>FFXI Treasure Casket Game</title>

        <link
            href="https://fonts.googleapis.com/css2?family=VT323&display=swap"
            rel="stylesheet"
        />

        <style>
            body {
                font-family: "VT323", monospace;
                max-width: 600px;
                margin: 0 auto;
                padding: 20px;
                background-color: #222;
                color: #eee;
            }

            h2 {
                text-align: center;
                color: #ffcc00;
                font-size: 28px;
            }

            .chat-container {
                border: 2px solid #444;
                border-radius: 8px;
                overflow: hidden;
                display: flex;
                flex-direction: column;
                height: 400px;
                background-color: #211b34;
            }

            .chat-messages {
                flex: 1;
                overflow-y: auto;
                padding: 10px;
                background-color: #211b34;
            }

            .message {
                margin-bottom: 10px;
                padding: 8px 12px;
                border-radius: 4px;
                max-width: 90%;
                word-wrap: break-word;
                font-size: 18px;
                line-height: 1.3;
            }

            .user-message {
                /* background-color: #2a5298; */
                color: white;
                align-self: flex-end;
                margin-left: auto;
                border-left: 4px solid #4a72b8;
            }

            .system-message {
                /* background-color: #444; */
                /* color: #ffcc00; */
                color: #eee;
                align-self: flex-start;
                border-left: 4px solid #ffcc00;
            }

            .chat-input {
                display: flex;
                padding: 10px;
                background-color: #333;
                border-top: 2px solid #444;
            }

            #message-input {
                flex: 1;
                padding: 8px 12px;
                border: 1px solid #555;
                border-radius: 4px;
                outline: none;
                background-color: #222;
                color: #fff;
                font-family: "VT323", monospace;
                font-size: 20px;
            }

            #send-button {
                background-color: #ffcc00;
                color: #222;
                border: none;
                border-radius: 4px;
                padding: 8px 16px;
                margin-left: 8px;
                cursor: pointer;
                font-family: "VT323", monospace;
                font-size: 18px;
                font-weight: bold;
            }

            #send-button:hover {
                background-color: #ffdd33;
            }

            .instructions {
                background-color: #333;
                padding: 15px;
                border-radius: 8px;
                margin-bottom: 20px;
                border-left: 4px solid #ffcc00;
            }

            .reset-button {
                display: block;
                margin: 20px auto 0;
                background-color: #993333;
                color: white;
                border: none;
                border-radius: 4px;
                padding: 8px 16px;
                cursor: pointer;
                font-family: "VT323", monospace;
                font-size: 18px;
            }

            .reset-button:hover {
                background-color: #cc4444;
            }
        </style>
    </head>
    <body>
        <h2>FFXI Treasure Casket Game</h2>

        <div class="instructions">
            <p>
                You've found a locked treasure casket! To open it, you must
                guess the correct 2-digit number (10-99).
            </p>
            <p>- Type a 2-digit number to guess</p>
            <p>- Type "examine" to get a hint about the number</p>
            <p>- You have 5 attempts before the lock jams</p>
        </div>

        <div class="chat-container">
            <div class="chat-messages" id="chat-messages">
                <!-- Messages will be added here -->
            </div>

            <div class="chat-input">
                <input
                    type="text"
                    id="message-input"
                    placeholder="Enter a number or 'examine'..."
                    autocomplete="off"
                />
                <button id="send-button">Try</button>
            </div>
        </div>

        <button class="reset-button" id="reset-button">
            New Treasure Casket
        </button>

        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const chatMessages = document.getElementById("chat-messages");
                const messageInput = document.getElementById("message-input");
                const sendButton = document.getElementById("send-button");
                const resetButton = document.getElementById("reset-button");

                // Initialize the game
                const game = new TreasureCasketGame();

                // Function to add a message to the chat
                function addMessage(text, isUser) {
                    const messageElement = document.createElement("div");
                    messageElement.classList.add("message");
                    messageElement.classList.add(
                        isUser ? "user-message" : "system-message",
                    );
                    messageElement.textContent = text;

                    chatMessages.appendChild(messageElement);

                    // Scroll to the bottom of the chat
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }

                // Function to validate input
                function validateInput(input) {
                    const trimmedInput = input.trim().toLowerCase();
                    return (
                        trimmedInput === "examine" ||
                        /^\d{2}$/.test(trimmedInput)
                    );
                }

                // Function to handle sending a message
                function sendMessage() {
                    const messageText = messageInput.value.trim();

                    if (messageText !== "" && validateInput(messageText)) {
                        // Add user message
                        addMessage(messageText, true);

                        // Process the input and get response
                        const response = game.processInput(messageText);

                        // Clear input field
                        messageInput.value = "";

                        // Add system response after a short delay
                        setTimeout(() => {
                            addMessage(response, false);
                        }, 500);
                    } else if (messageText !== "") {
                        // Provide feedback for invalid input
                        addMessage(
                            "You must either examine the lock or enter a two-digit number.",
                            false,
                        );
                    }
                }

                // Function to reset the game
                function resetGame() {
                    const resetMessage = game.reset();
                    addMessage(resetMessage, false);
                }

                // Event listeners
                sendButton.addEventListener("click", sendMessage);

                messageInput.addEventListener("keypress", function (event) {
                    if (event.key === "Enter") {
                        sendMessage();
                    }
                });

                resetButton.addEventListener("click", resetGame);

                // Add a welcome message
                addMessage(
                    "You've discovered a locked treasure casket! Guess the correct two-digit number to open it, or type 'examine' for a hint.",
                    false,
                );
            });

            // TreasureCasketGame class definition
            class TreasureCasketGame {
                constructor() {
                    // Generate a random 2-digit number between 10 and 99
                    this.targetNumber = Math.floor(Math.random() * 90) + 10;
                    this.attempts = 0;
                    this.maxAttempts = 5;
                    this.hintGiven = false;
                    this.isOpen = false;
                }

                // Get the left (tens) digit of the target number
                getLeftDigit() {
                    return Math.floor(this.targetNumber / 10);
                }

                // Get the right (ones) digit of the target number
                getRightDigit() {
                    return this.targetNumber % 10;
                }

                // Generate a random hint that is true about the target number
                getHint() {
                    // Create an array of possible true hints
                    const possibleHints = [];

                    // Check left digit and add appropriate hints
                    if (this.getLeftDigit() % 2 === 0) {
                        possibleHints.push(
                            "You have a hunch that the left digit is even.",
                        );
                    } else {
                        possibleHints.push(
                            "You have a hunch that the left digit is odd.",
                        );
                    }

                    // Check right digit and add appropriate hints
                    if (this.getRightDigit() % 2 === 0) {
                        possibleHints.push(
                            "You have a hunch that the right digit is even.",
                        );
                    } else {
                        possibleHints.push(
                            "You have a hunch that the right digit is odd.",
                        );
                    }

                    // Return a random hint from the possible true hints
                    const randomIndex = Math.floor(
                        Math.random() * possibleHints.length,
                    );
                    this.hintGiven = true;
                    return possibleHints[randomIndex];
                }

                // Process a guess or examine command
                processInput(input) {
                    // Trim and convert to lowercase
                    const cleanInput = input.trim().toLowerCase();

                    // If the casket is already open, return appropriate message
                    if (this.isOpen) {
                        return "The treasure casket is already open!";
                    }

                    // If max attempts reached, return failure message
                    if (this.attempts >= this.maxAttempts) {
                        this.isOpen = true; // Lock the casket permanently
                        return `The lock jams! The treasure casket remains locked. The correct number was ${this.targetNumber}.`;
                    }

                    // Handle "examine" command
                    if (cleanInput === "examine") {
                        if (this.hintGiven) {
                            return "You've already examined the lock. Try guessing a number.";
                        } else {
                            return this.getHint();
                        }
                    }

                    // Handle number guesses
                    if (/^\d{2}$/.test(cleanInput)) {
                        const guess = parseInt(cleanInput, 10);
                        this.attempts++;

                        // Check if guess is correct
                        if (guess === this.targetNumber) {
                            this.isOpen = true;
                            return "The lock clicks open! You found the treasure!";
                        } else {
                            // Provide feedback on the guess
                            const remainingAttempts =
                                this.maxAttempts - this.attempts;

                            if (remainingAttempts <= 0) {
                                this.isOpen = true;
                                return `The lock jams! The treasure casket remains locked. The correct number was ${this.targetNumber}.`;
                            }

                            let message = "Incorrect. ";

                            // Give a hint about whether the guess is too high or too low
                            if (guess < this.targetNumber) {
                                message +=
                                    "The lock won't budge. Maybe try a higher number?";
                            } else {
                                message +=
                                    "The lock won't budge. Maybe try a lower number?";
                            }

                            message += ` (${remainingAttempts} attempt${remainingAttempts !== 1 ? "s" : ""} remaining)`;
                            return message;
                        }
                    }

                    // Handle invalid input
                    return "You must either examine the lock or enter a two-digit number.";
                }

                // Reset the game with a new number
                reset() {
                    this.targetNumber = Math.floor(Math.random() * 90) + 10;
                    this.attempts = 0;
                    this.hintGiven = false;
                    this.isOpen = false;
                    return "A new treasure casket appears before you!";
                }
            }
        </script>
    </body>
</html>
